@import url('https://fonts.googleapis.com/css2?family=Klee+One:wght@400;600&family=Noto+Serif+JP:wght@400;700&display=swap');
      
/* --- TRACING  STYLE --- */
.kanji-trace {
    font-family: 'Klee One', 'UD Digi Kyokasho N-R', 'UD Digi Kyokasho', 'UD デジタル 教科書体 N-R', 'UD デジタル 教科書体', cursive;
    color: #bfbfbf; 
    -webkit-text-stroke: 0px white; 
    paint-order: stroke fill;
    position: relative;
    z-index: 10;
    line-height: 0; 
    user-select: none;
}
 
/* --- DECOMPOSITION SVG STYLE --- */
.decomp-svg {
    width: 100%;
    height: 100%;
    display: block;
}
.decomp-svg path {
    stroke: #000;
    stroke-width: 3px;
    fill: none;
    stroke-linecap: round;
    stroke-linejoin: round;
}

/* --- INLINE REFERENCE SVG STYLE (BOX 1 FIX) --- */
.ref-wrapper {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.ref-wrapper svg {
    width: 100% !important;
    height: 100% !important;
    display: block;
    transform-origin: center center;
    transform: translate(var(--guide-x, 0px), var(--guide-y, 0px)) scale(var(--guide-scale, 0.9));
}

.ref-wrapper text {
    font-size: 8px;
    fill: #999;
    font-family: sans-serif;
}
.ref-wrapper path {
    stroke: #000;
    stroke-width: 3px;
    fill: none;
    stroke-linecap: round;
    stroke-linejoin: round;
}

/* --- PRINT CONFIGURATION --- */
@media print {
    @page {
        size: A4 portrait;
        margin: 0;
    }

    html, body {
        width: 210mm;
        min-height: 297mm;
        margin: 0 !important;
        padding: 0 !important;
        background: white;
    }

    #root {
        width: 100%;
    }

    .no-print {
        display: none !important;
    }

    .a4-page {
        width: 210mm !important;
        height: 296mm !important; 
        margin: 0 !important;
        padding-top: 10mm !important;
        padding-bottom: 0 !important;
        page-break-after: always !important;
        overflow: hidden !important;
        box-shadow: none !important;
        border: none !important;
    }
    .print-layout-reset {
        overflow: visible !important; 
        height: auto !important;       
        display: block !important;    
    }
    ::-webkit-scrollbar {
        display: none !important;
    }
}

@media screen {
    body {
        background-color: #f3f4f6;
    }
    .a4-page {
        width: 210mm;
        height: 297mm;
        background: white;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        margin-bottom: 2rem;
    }
}

/* --- 1. CLASS ẨN THANH TRƯỢT (Dùng cho Sidebar bên ngoài) --- */
.hide-scrollbar::-webkit-scrollbar {
    display: none;
}
.hide-scrollbar {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
}

/* --- 2. CLASS THANH TRƯỢT ĐẸP (Custom Scrollbar - ĐÃ SỬA MÀU) --- */
.custom-scrollbar {
    scrollbar-width: thin;
    /* Màu mặc định cho Firefox */
    scrollbar-color: #bfdbfe #ffffff; 
}

.custom-scrollbar::-webkit-scrollbar {
    width: 6px; 
}

.custom-scrollbar::-webkit-scrollbar-track {
    background: #ffffff;
    border-radius: 10px;
}

/* Mặc định thanh cuộn (Màu Tím nhạt) */
.custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #a5b4fc; 
    border-radius: 10px;
    transition: background-color 0.3s ease;
}

/* --- QUAN TRỌNG: CHẾ ĐỘ KANJI (Màu Tím Than) --- */
/* Dùng !important để đảm bảo không bị đè */
.mode-kanji .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #a5b4fc !important; /* Indigo 300 */
}

.mode-kanji .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: #6366f1 !important; /* Indigo 500 */
}

/* --- QUAN TRỌNG: CHẾ ĐỘ TỪ VỰNG (Màu Xanh Lá) --- */
/* Dùng !important để bắt buộc đổi màu */
.mode-vocab .custom-scrollbar::-webkit-scrollbar-thumb {
    background-color: #34d399 !important; /* Emerald 400 */
}

.mode-vocab .custom-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: #059669 !important; /* Emerald 600 */
}

/* --- 3. CLASS THANH TRƯỢT TRONG SUỐT --- */
.input-scrollbar::-webkit-scrollbar {
    width: 14px; 
}

/* Nền trong suốt và có margin để tránh góc bo */
.input-scrollbar::-webkit-scrollbar-track {
    background: transparent; 
    margin-top: 8px;    
    margin-bottom: 8px; 
}

/* Cục lăn: Bo tròn và nằm lơ lửng ở giữa */
.input-scrollbar::-webkit-scrollbar-thumb {
    background-color: #cbd5e1; 
    border-radius: 20px;        
    border: 5px solid transparent; 
    background-clip: content-box;  
}

.input-scrollbar::-webkit-scrollbar-thumb:hover {
    background-color: #94a3b8; 
}

/* --- ANIMATION STROKE STYLE (Dynamic Speed) --- */
@keyframes drawStroke {
    0% { stroke-dashoffset: 500; opacity: 0; }
    10% { opacity: 1; }
    100% { stroke-dashoffset: 0; opacity: 1; }
}

@keyframes fadeInNumber {
    to { opacity: 0.7; }
}

.stroke-anim-path {
    fill: none;
    stroke: #333; 
    stroke-width: 4px; 
    stroke-linecap: round;
    stroke-linejoin: round;
    stroke-dasharray: 500; 
    stroke-dashoffset: 500;
    opacity: 0;
    animation-name: drawStroke;
    animation-timing-function: ease-out;
    animation-fill-mode: forwards;
}

.stroke-number {
    font-size: 8px;
    fill: #999;
    font-family: sans-serif;
    opacity: 0; 
    animation: fadeInNumber 0.5s forwards; 
}

/* --- CSS ĐỔI MÀU CHỮ KHI HOVER VÀO Ô ĐẦU TIÊN --- */
.reference-box:hover path {
    stroke: #4f46e5 !important; /* Màu xanh Indigo-600 */
    transition: stroke 0.2s ease;
}

.reference-box:hover .kanji-trace {
    color: #4f46e5 !important; 
    transition: color 0.2s ease;
}

/* Hiệu ứng mượt cho Flashcard */
.exit-left {
    transform: translateX(-150%) rotate(-15deg);
    opacity: 0;
    transition: all 0.4s ease-in;
}

.exit-right {
    transform: translateX(150%) rotate(15deg);
    opacity: 0;
    transition: all 0.4s ease-in;
}

/* Đảm bảo backface-visibility hoạt động tốt trên mobile */
[transform-style="preserve-3d"] {
    perspective: 1000px;
}

/* Hiệu ứng hover cho thumb tiến độ */
.progress-thumb-animate {
    transition: left 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* --- KAKIMASHOU STYLES (COPY 100%) --- */
.padBackground { fill: #fff; }
.padLine1 { stroke: #f5f5f5; stroke-width: 1; stroke-dasharray: 4, 4; }
.padLine2 { stroke: #dfdfdf; stroke-width: 1; stroke-dasharray: 4, 4; }
.padBorder { stroke: #ccc; stroke-width: 1.5; }

/* Các trạng thái của nét viết */
.correctStroke { 
    stroke: #000; 
    stroke-linecap: round; 
    stroke-linejoin: round; 
    stroke-width: 7; /* Đậm như bút lông */
    transition: all 0.5s ease;
    filter: url(#glow); /* Hiệu ứng phát sáng */
}
.wrongStroke { 
    stroke: #ff0000; 
    stroke-width: 7;
    stroke-linecap: round; 
    stroke-linejoin: round;
    opacity: 0; 
    transition: opacity 0.5s ease; /* Hiệu ứng biến mất dần */
}
.warningStroke {
    stroke: #d4a017; /* Màu vàng nhắc nhở gần đúng */
    stroke-width: 7;
    stroke-linecap: round; 
    stroke-linejoin: round;
}
.hintStroke {
    stroke: #3991d4;
    stroke-width: 7;
    stroke-dasharray: 5,5;
    opacity: 0.5;
    fill: none;
}

/* User đang vẽ */
#userStrokes path {
    fill: none;
    stroke: #8040ff; /* Màu tím khi đang vẽ */
    stroke-width: 7;
    stroke-linecap: round;
    stroke-linejoin: round;
    opacity: 0.8;
}

/* Ẩn Kanji gốc để người dùng tự viết đè lên */
#kanjiVG path {
    stroke: #e0e0e0; /* Màu xám nhạt làm nền */
    stroke-width: 4;
    fill: none;
    stroke-linecap: round; 
    stroke-linejoin: round;
}
